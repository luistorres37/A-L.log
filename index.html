<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A&L Log</title>
  <link rel="stylesheet" href="style.css" />
  
</head>
<body>
  <main class="container">
    <h1 class="app-title">A&L Log</h1>
    <p class="app-sub">Jobs and inventory for the crew. Data saves on your phone.</p>

    <!-- Tabs -->
    <nav class="nav">
      <button id="jobsTab" class="tab active">Jobs</button>
      <button id="inventoryTab" class="tab">Inventory</button>
      <button id="importTab" class="tab">Export / Import</button>
    </nav>

    <!-- JOBS -->
    <section id="jobsSection" class="card">
      <h2>Jobs</h2>

      <input id="lotInput" placeholder="Lot # / Name" />
      <input id="addressInput" placeholder="Address" />
      <input id="taskInput" placeholder="Task (Backsplash, Demo, etc.)" />
      <input id="dateInput" type="date" />
      <select id="statusSelect">
        <option>To-do</option>
        <option>Done</option>
      </select>

      <div class="actions">
        <button id="addJobBtn" type="button" class="primary">Add job</button>
        <button id="filterAllBtn" type="button">All</button>
        <button id="filterTodoBtn" type="button">To-do</button>
        <button id="filterDoneBtn" type="button">Done</button>
      </div>

      <table class="table">
        <thead>
          <tr><th>Lot</th><th>Address</th><th>Task</th><th>Date</th><th>Status</th></tr>
        </thead>
        <tbody id="jobsBody"></tbody>
      </table>
    </section>

    <!-- INVENTORY -->
    <section id="inventorySection" class="card" hidden>
      <h2>Inventory</h2>

      <select id="invType">
        <option>Caulk</option>
        <option>Grout</option>
        <option>Tool</option>
        <option>Other</option>
      </select>
      <input id="invName" placeholder="Name / Color (e.g., Mapei #38 Avalanche)" />
      <input id="invQty" type="number" inputmode="numeric" placeholder="Qty" />
      <input id="invLoc" placeholder="Location (Truck, Garage)" />

      <div class="actions">
        <button id="addInvBtn" type="button" class="primary">Add / Update item</button>
        <button data-filter="All" class="chip">All</button>
        <button data-filter="Caulk" class="chip">Caulk</button>
        <button data-filter="Grout" class="chip">Grout</button>
        <button data-filter="Tool"  class="chip">Tool</button>
        <button data-filter="Other" class="chip">Other</button>
      </div>

      <table class="table">
        <thead>
          <tr><th>Type</th><th>Name</th><th>Qty</th><th>Location</th></tr>
        </thead>
        <tbody id="invBody"></tbody>
      </table>
    </section>

    <!-- EXPORT / IMPORT -->
    <section id="importSection" class="card" hidden>
      <h2>Export / Import</h2>
      <div class="actions">
        <button id="exportBtn" class="chip">Export data</button>
        <label class="chip">
          <input id="importFile" type="file" hidden />
          Choose File
        </label>
        <span id="fileName" class="muted">no file selected</span>
        <button id="importBtn" class="chip">Import</button>
      </div>
      <p class="muted">Export saves a JSON file of your Jobs + Inventory. Import will replace your current data with a file you pick.</p>
    </section>
  </main>

  <script type="module">
  /* ---------- Firebase imports ---------- */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getFirestore, collection, doc, addDoc, setDoc,
    onSnapshot, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  /* ---------- Your Firebase config (keep yours) ---------- */
  const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_DOMAIN",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_SENDER",
    appId: "YOUR_APP",
    measurementId: "YOUR_MEAS"
  };

  /* ---------- Init ---------- */
  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  /* ---------- DOM helpers ---------- */
  const $ = id => document.getElementById(id);

  /* ---------- In-memory data ---------- */
  let jobs = [];
  let inventory = [];
  let currentJobFilter = 'all';
  let invFilter = 'All';

  /* ---------- Renderers (use your existing table markup) ---------- */
  function renderJobs(filter='all') {
    currentJobFilter = filter;
    const tbody = $('jobsBody');
    tbody.innerHTML = '';
    (filter === 'all' ? jobs : jobs.filter(j => j.status === filter))
      .forEach(j => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${j.lot||''}</td>
          <td>${j.addr||''}</td>
          <td>${j.task||''}</td>
          <td>${j.date||''}</td>
          <td>${j.status||''}</td>`;
        tbody.appendChild(tr);
      });
  }

  function renderInventory(filter='All') {
    invFilter = filter;
    const tbody = $('invBody');
    tbody.innerHTML = '';
    (filter === 'All' ? inventory : inventory.filter(i => i.type === filter))
      .forEach(i => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i.type}</td>
          <td>${i.name}</td>
          <td>${i.qty||0}</td>
          <td>${i.loc||''}</td>`;
        tbody.appendChild(tr);
      });
  }

  /* ---------- Add / update actions (write to Firestore) ---------- */
  async function addJob() {
    const data = {
      lot: $('lotInput').value.trim(),
      addr: $('addressInput').value.trim(),
      task: $('taskInput').value.trim(),
      date: $('dateInput').value,
      status: $('statusSelect').value,
      ts: serverTimestamp()
    };
    if (!data.lot && !data.addr && !data.task) return;
    await addDoc(collection(db, 'jobs'), data);
    $('lotInput').value = '';
    $('addressInput').value = '';
    $('taskInput').value = '';
  }

  async function addOrUpdateItem() {
    const item = {
      type: $('invType').value,
      name: $('invName').value.trim(),
      qty: parseInt($('invQty').value || '0', 10) || 0,
      loc: $('invLoc').value.trim(),
      ts: serverTimestamp()
    };
    if (!item.name) return;
    const id = `${item.type}-${item.name}`.toLowerCase(); // stable doc id
    await setDoc(doc(db, 'inventory', id), item, { merge: true });
    $('invName').value = '';
    $('invQty').value  = '';
  }

  /* ---------- Real-time listeners (everyone sees updates live) ---------- */
  onSnapshot(collection(db, 'jobs'), snap => {
    jobs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderJobs(currentJobFilter);
  });

  onSnapshot(collection(db, 'inventory'), snap => {
    inventory = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderInventory(invFilter);
  });

  /* ---------- Buttons & tabs ---------- */
  $('addJobBtn').addEventListener('click', addJob);
  $('filterAllBtn').addEventListener('click', () => renderJobs('all'));
  $('filterTodoBtn').addEventListener('click', () => renderJobs('To-do'));
  $('filterDoneBtn').addEventListener('click', () => renderJobs('Done'));

  $('addInvBtn').addEventListener('click', addOrUpdateItem);
  document.querySelectorAll('#inventorySection [data-filter]').forEach(btn => {
    btn.addEventListener('click', () => renderInventory(btn.getAttribute('data-filter')));
  });

  function showTab(name) {
    $('jobsSection').hidden = name !== 'jobs';
    $('inventorySection').hidden = name !== 'inventory';
    $('importSection').hidden = name !== 'import';
    document.querySelectorAll('.tab').forEach(b => b.classList.toggle('active', b.id === name + 'Tab'));
  }
  $('jobsTab').addEventListener('click', () => showTab('jobs'));
  $('inventoryTab').addEventListener('click', () => showTab('inventory'));
  $('importTab').addEventListener('click', () => showTab('import'));
  showTab('jobs');
</script>

<script type="module">
  // Import Firebase functions
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";

  // Your Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCtvU9eDn5qV8YmqL0_Zj60P...",
    authDomain: "al-log-f4851.firebaseapp.com",
    projectId: "al-log-f4851",
    storageBucket: "al-log-f4851.appspot.com",
    messagingSenderId: "170098316049",
    appId: "1:170098316049:web:25899919254...",
    measurementId: "G-MWP6D9EWZ5"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>
  </body>
</html>
