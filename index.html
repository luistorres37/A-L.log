<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A&L Log</title>
  <link rel="stylesheet" href="style.css" />
  
</head>
<body>
  <main class="container">
    <h1 class="app-title">A&L Log</h1>
    <p class="app-sub">Jobs and inventory for the crew. Data saves on your phone.</p>

    <!-- Tabs -->
    <nav class="nav">
      <button id="jobsTab" class="tab active">Jobs</button>
      <button id="inventoryTab" class="tab">Inventory</button>
      <button id="importTab" class="tab">Export / Import</button>
    </nav>

    <!-- JOBS -->
    <section id="jobsSection" class="card">
      <h2>Jobs</h2>

      <input id="lotInput" placeholder="Lot # / Name" />
      <input id="addressInput" placeholder="Address" />
      <input id="taskInput" placeholder="Task (Backsplash, Demo, etc.)" />
      <input id="dateInput" type="date" />
      <select id="statusSelect">
        <option>To-do</option>
        <option>Done</option>
      </select>

      <div class="actions">
        <button id="addJobBtn" type="button" class="primary">Add job</button>
        <button id="filterAllBtn" type="button">All</button>
        <button id="filterTodoBtn" type="button">To-do</button>
        <button id="filterDoneBtn" type="button">Done</button>
      </div>

      <table class="table">
        <thead>
          <tr><th>Lot</th><th>Address</th><th>Task</th><th>Date</th><th>Status</th></tr>
        </thead>
        <tbody id="jobsBody"></tbody>
      </table>
    </section>

    <!-- INVENTORY -->
    <section id="inventorySection" class="card" hidden>
      <h2>Inventory</h2>

      <select id="invType">
        <option>Caulk</option>
        <option>Grout</option>
        <option>Tool</option>
        <option>Other</option>
      </select>
      <input id="invName" placeholder="Name / Color (e.g., Mapei #38 Avalanche)" />
      <input id="invQty" type="number" inputmode="numeric" placeholder="Qty" />
      <input id="invLoc" placeholder="Location (Truck, Garage)" />

      <div class="actions">
        <button id="addInvBtn" type="button" class="primary">Add / Update item</button>
        <button data-filter="All" class="chip">All</button>
        <button data-filter="Caulk" class="chip">Caulk</button>
        <button data-filter="Grout" class="chip">Grout</button>
        <button data-filter="Tool"  class="chip">Tool</button>
        <button data-filter="Other" class="chip">Other</button>
      </div>

      <table class="table">
        <thead>
          <tr><th>Type</th><th>Name</th><th>Qty</th><th>Location</th></tr>
        </thead>
        <tbody id="invBody"></tbody>
      </table>
    </section>

    <!-- EXPORT / IMPORT -->
    <section id="importSection" class="card" hidden>
      <h2>Export / Import</h2>
      <div class="actions">
        <button id="exportBtn" class="chip">Export data</button>
        <label class="chip">
          <input id="importFile" type="file" hidden />
          Choose File
        </label>
        <span id="fileName" class="muted">no file selected</span>
        <button id="importBtn" class="chip">Import</button>
      </div>
      <p class="muted">Export saves a JSON file of your Jobs + Inventory. Import will replace your current data with a file you pick.</p>
    </section>
  </main>

  <script>
// ===== A&L Log (inline) =====
const $=id=>document.getElementById(id);
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const load=(k,d)=>JSON.parse(localStorage.getItem(k)||JSON.stringify(d));

let jobs=load('jobs',[]);
let inventory=load('inventory',[]);
const tabs={jobs:$('jobsSection'),inventory:$('inventorySection'),import:$('importSection')};

function showTab(name){
  tabs.jobs.hidden = name!=='jobs';
  tabs.inventory.hidden = name!=='inventory';
  tabs.import.hidden = name!=='import';
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  if(name==='jobs') $('jobsTab').classList.add('active');
  if(name==='inventory') $('inventoryTab').classList.add('active');
  if(name==='import') $('importTab').classList.add('active');
}

// ---- JOBS ----
let currentJobFilter='all';

function addJob(){
  const lot=$('lotInput').value.trim();
  const addr=$('addressInput').value.trim();
  const task=$('taskInput').value.trim();
  const date=$('dateInput').value||'';
  const status=$('statusSelect').value;
  if(!lot && !addr && !task) return;
  jobs.push({lot,addr,task,date,status});
  save('jobs',jobs);
  renderJobs(currentJobFilter);
  $('lotInput').value=''; $('addressInput').value=''; $('taskInput').value=''; $('dateInput').value='';
}

function renderJobs(filter='all'){
  currentJobFilter=filter;
  const tbody=$('jobsBody'); tbody.innerHTML='';
  (filter==='all'?jobs:jobs.filter(j=>j.status===filter)).forEach(j=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${j.lot||''}</td><td>${j.addr||''}</td><td>${j.task||''}</td><td>${j.date||''}</td><td>${j.status}</td>`;
    tbody.appendChild(tr);
  });
}

// ---- INVENTORY ----
let invFilter='All';
function addOrUpdateItem(){
  const type=$('invType').value;
  const name=$('invName').value.trim();
  const qty=parseInt($('invQty').value||'0',10);
  const loc=$('invLoc').value.trim();
  if(!name) return;
  const idx=inventory.findIndex(i=>i.type===type && i.name.toLowerCase()===name.toLowerCase());
  if(idx>=0){inventory[idx].qty=qty; inventory[idx].loc=loc;} else {inventory.push({type,name,qty,loc});}
  save('inventory',inventory);
  renderInventory(invFilter);
  $('invName').value=''; $('invQty').value=''; $('invLoc').value='';
}

function renderInventory(filter='All'){
  invFilter=filter;
  const tbody=$('invBody'); tbody.innerHTML='';
  (filter==='All'?inventory:inventory.filter(i=>i.type===filter)).forEach(i=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i.type}</td><td>${i.name}</td><td>${i.qty}</td><td>${i.loc||''}</td>`;
    tbody.appendChild(tr);
  });
}

// ---- EXPORT / IMPORT ----
$('importFile')?.addEventListener('change',e=>{$('fileName').textContent=e.target.files[0]?.name||'no file selected';});
function doExport(){
  const blob=new Blob([JSON.stringify({jobs,inventory},null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url; a.download='al-log-data.json'; a.click(); URL.revokeObjectURL(url);
}
async function doImport(){
  const f=$('importFile').files[0]; if(!f) return;
  const text=await f.text(); const data=JSON.parse(text||'{}');
  jobs=data.jobs||[]; inventory=data.inventory||[]; save('jobs',jobs); save('inventory',inventory);
  renderJobs('all'); renderInventory('All'); showTab('jobs');
}

// ---- WIRE UP AFTER HTML IS READY ----
document.addEventListener('DOMContentLoaded',()=>{
  $('jobsTab').addEventListener('click',()=>showTab('jobs'));
  $('inventoryTab').addEventListener('click',()=>showTab('inventory'));
  $('importTab').addEventListener('click',()=>showTab('import'));

  $('addJobBtn').addEventListener('click',addJob);
  $('filterAllBtn').addEventListener('click',()=>renderJobs('all'));
  $('filterTodoBtn').addEventListener('click',()=>renderJobs('To-do'));
  $('filterDoneBtn').addEventListener('click',()=>renderJobs('Done'));

  $('addInvBtn').addEventListener('click',addOrUpdateItem);
  document.querySelectorAll('#inventorySection [data-filter]').forEach(btn=>{
    btn.addEventListener('click',()=>renderInventory(btn.getAttribute('data-filter')));
  });

  $('exportBtn').addEventListener('click',doExport);
  $('importBtn').addEventListener('click',doImport);

  renderJobs('all'); renderInventory('All'); showTab('jobs');
});
</script>
</body>
</html>
